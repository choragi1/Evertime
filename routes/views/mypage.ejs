<!doctype html>
<html>
  <head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS,JS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

<!-- CSS -->
<link rel="stylesheet" href="/public/css/total.css" >

<!-- JQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <title>마이페이지</title>
  </head>
  <body>
    <%- include('login.ejs')  %>
    <%- include('nav.ejs')  %>
    
    
    

    <div>
      <form style="padding: 10px;" action="/member/edit?_method=PUT" method="POST">
        <div class="card col-md-7">
          <div class="card-body">
            <h4 style="text-align: center;"><%= userinfo.id %> 님의 마이페이지입니다.</h4>
            
            
            <div class="row col-md-5 form-inline" style="float:none; margin:auto;">
              <div class="mb-3">
                <label for="user_nick" class="form-label">닉네임</label>
                <input type="text" class="form-control" id="user_nick" name="user_name" value="<%= userinfo.nickname %>">
              </div>
            </div>
            
            <div class="row col-md-5 form-inline" style="float:none; margin:auto;">
              <div class="mb-3">
                <label for="user_name" class="form-label">이름</label>
                <input type="text" class="form-control" id="user_name" name="user_name" value="<%= userinfo.name %>">
              </div>
            </div>
            
            
            <div class="row col-md-5 form-inline" style="float:none; margin:auto;">
              <div class="mb-3">
                <label for="user_email" class="form-label">이메일</label>
                <input type="email" class="form-control" id="user_email" name="user_email" value="<%= userinfo.email %>">
              </div>
              <input type="hidden" id="user_keyid" name="keyid" value="<%= userinfo._id %>">
            </div>

            <div class="row col-md-5 form-inline" style="float:none; margin:auto;">
              <div class="mb-3">
                <label for="user_pw" class="form-label">비밀번호 확인</label>
                <div>
                <input type="password" class="form-control" id="user_pw" name="user_pw">
                </div>
              </div>
            </div>

            <button type="button" id="useredit" class="btn btn-outline-danger" style="float:right;">수정</button>
          </div>
        </div>
      </form>
    </div>
    

  <%- include('loginani.ejs') %>


  <script>

    $('#useredit').click(() => {
      let userPW = $("#user_pw").val();
      let userNick = $("#user_nick").val();
      let userName = $("#user_name").val();
      let userEmail = $("#user_email").val();
      let userNo = $("#user_keyid").val();

      let reg_nick = /^([a-zA-Z0-9ㄱ-ㅎ|ㅏ-ㅣ|가-힣]).{1,10}$/;
      let reg_name = /^([a-zA-Z0-9ㄱ-ㅎ|ㅏ-ㅣ|가-힣]).{1,10}$/;
      let reg_email = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/;

      if (userPW==='') {
        alert('비밀번호를 입력해주세요')
      } else if (!reg_nick.test(userNick)) {
        alert('닉네임은 2~10자리 내의 한글,영문만 사용가능합니다.')
      } else if (!reg_name.test(userName)) {
        alert('이름은 2~10자리 내의 한글,영문만 사용가능합니다.')
      } else if (!reg_email.test(userEmail)) {
        alert('이메일 양식을 확인해주세요.')
      } else {
        $.ajax({
          method: 'PUT',
          url: '/member/edit',
          data: { userPW: userPW, userNick: userNick, userName: userName, userEmail: userEmail, userNo: userNo },

        }).done((data, textStatus, xhr) => {
            alert(data)
            if(data!='비밀번호가 틀렸습니다.'){
            history.back();
          }
          })
      }

      
    })








  </script>

  </body>
</html>